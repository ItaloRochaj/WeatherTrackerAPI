# WeatherTrackerAPI üöÄ

Uma API RESTful desenvolvida em .NET 9 que integra com a NASA API para coletar, processar e armazenar dados astron√¥micos, fornecendo endpoints seguros para consulta de informa√ß√µes espaciais hist√≥ricas e em tempo real.

## üìã √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Tecnologias Utilizadas](#tecnologias-utilizadas)
- [Arquitetura do Projeto](#arquitetura-do-projeto)
- [Funcionalidades](#funcionalidades)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Configura√ß√£o e Instala√ß√£o](#configura√ß√£o-e-instala√ß√£o)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [API Endpoints](#api-endpoints)
- [Autentica√ß√£o e Autoriza√ß√£o](#autentica√ß√£o-e-autoriza√ß√£o)
- [Banco de Dados](#banco-de-dados)
- [Configura√ß√µes](#configura√ß√µes)
- [Testes](#testes)
- [Deploy](#deploy)
- [Contribui√ß√£o](#contribui√ß√£o)
- [Roadmap de Desenvolvimento](#roadmap-de-desenvolvimento)

## üåü Vis√£o Geral

O WeatherTrackerAPI √© uma aplica√ß√£o backend desenvolvida como parte de uma avalia√ß√£o t√©cnica para demonstrar conhecimentos em:

- **Integra√ß√£o com APIs externas** (NASA API)
- **Arquitetura em camadas** com .NET 9
- **Autentica√ß√£o JWT**
- **Persist√™ncia de dados** com Entity Framework Core
- **Documenta√ß√£o** com Swagger/OpenAPI
- **Boas pr√°ticas** de desenvolvimento

### üéØ Objetivo Principal

Criar uma API que consuma dados da NASA API (Astronomy Picture of the Day - APOD), processe essas informa√ß√µes, as armazene em um banco de dados e forne√ßa endpoints seguros para consulta de dados hist√≥ricos e tend√™ncias astron√¥micas.

## üõ†Ô∏è Tecnologias Utilizadas

### Backend
- **.NET 9** - Framework principal
- **ASP.NET Core Web API** - Para cria√ß√£o da API REST
- **Entity Framework Core** - ORM para acesso ao banco de dados
- **SQL Server** - Banco de dados principal
- **AutoMapper** - Mapeamento entre objetos
- **JWT Bearer** - Autentica√ß√£o e autoriza√ß√£o

### Ferramentas e Bibliotecas
- **Swagger/OpenAPI** - Documenta√ß√£o da API
- **Newtonsoft.Json** - Serializa√ß√£o JSON
- **BCrypt.Net** - Hash de senhas
- **HttpClient** - Requisi√ß√µes HTTP para APIs externas
- **FluentValidation** - Valida√ß√£o de dados
- **Serilog** - Logging estruturado

### Testes
- **xUnit** - Framework de testes
- **Microsoft.AspNetCore.Mvc.Testing** - Testes de integra√ß√£o
- **Moq** - Mocking para testes unit√°rios

## üèóÔ∏è Arquitetura do Projeto

```
WeatherTrackerAPI/
‚îú‚îÄ‚îÄ üìÅ Controllers/          # Controladores da API
‚îú‚îÄ‚îÄ üìÅ Services/            # L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ üìÅ Repositories/        # Acesso a dados
‚îú‚îÄ‚îÄ üìÅ Models/              # Entidades do dom√≠nio
‚îú‚îÄ‚îÄ üìÅ DTOs/                # Objetos de transfer√™ncia de dados
‚îú‚îÄ‚îÄ üìÅ Data/                # Contexto do banco de dados
‚îú‚îÄ‚îÄ üìÅ Configurations/      # Classes de configura√ß√£o
‚îú‚îÄ‚îÄ üìÅ Middleware/          # Middleware customizado
‚îú‚îÄ‚îÄ üìÅ Extensions/          # M√©todos de extens√£o
‚îú‚îÄ‚îÄ üìÅ Mappings/            # Perfis do AutoMapper
‚îî‚îÄ‚îÄ üìÅ Tests/               # Testes unit√°rios e integra√ß√£o
```

### Padr√µes Implementados
- **Repository Pattern** - Abstra√ß√£o do acesso a dados
- **Dependency Injection** - Inje√ß√£o de depend√™ncias
- **DTO Pattern** - Transfer√™ncia de dados
- **Middleware Pattern** - Processamento de requests
- **Configuration Pattern** - Gerenciamento de configura√ß√µes

## ‚ö° Funcionalidades

### üîê Autentica√ß√£o e Autoriza√ß√£o
- [x] Registro de usu√°rios com valida√ß√£o
- [x] Login com JWT tokens
- [x] Middleware de autentica√ß√£o personalizado
- [x] Prote√ß√£o de endpoints sens√≠veis

### üåå Integra√ß√£o NASA API
- [x] Consumo da NASA APOD API
- [x] Transforma√ß√£o e valida√ß√£o de dados
- [x] Cache de requisi√ß√µes para otimiza√ß√£o
- [x] Tratamento de erros e fallbacks

### üíæ Persist√™ncia de Dados
- [x] Armazenamento de dados astron√¥micos
- [x] Hist√≥rico de usu√°rios e consultas
- [x] Queries otimizadas para relat√≥rios
- [x] Migrations autom√°ticas

### üìä Endpoints da API
- [x] CRUD completo para dados astron√¥micos
- [x] Consultas com filtros e pagina√ß√£o
- [x] Endpoints de relat√≥rios e estat√≠sticas
- [x] Healthcheck e monitoring

## üìã Pr√©-requisitos

### Software Necess√°rio
- [.NET 9 SDK](https://dotnet.microsoft.com/download/dotnet/9.0)
- [SQL Server](https://www.microsoft.com/sql-server/sql-server-downloads) ou [SQL Server Express](https://www.microsoft.com/sql-server/sql-server-editions/express)
- [Visual Studio 2022](https://visualstudio.microsoft.com/) ou [VS Code](https://code.visualstudio.com/)
- [Git](https://git-scm.com/)

### Contas e APIs
- **NASA API Key**: Obtenha gratuitamente em [NASA Open Data](https://api.nasa.gov/)
  - Chave utilizada no projeto: `zR5OaEYqLP8dUuP3TjgJBz7PsVYKQaWOhhbqKgjd`

## üöÄ Configura√ß√£o e Instala√ß√£o

### 1. Clone o Reposit√≥rio
```bash
git clone https://github.com/ItaloRochaj/WeatherTrackerAPI.git
cd WeatherTrackerAPI
```

### 2. Configura√ß√£o do Banco de Dados
```bash
# Instalar ferramentas EF Core (se n√£o instalado)
dotnet tool install --global dotnet-ef

# Criar e aplicar migrations
dotnet ef migrations add InitialCreate
dotnet ef database update
```

### 3. Configura√ß√£o das Vari√°veis de Ambiente
Crie um arquivo `appsettings.Development.json`:

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "ConnectionStrings": {
    "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=WeatherTrackerDB;Trusted_Connection=true;MultipleActiveResultSets=true"
  },
  "JwtSettings": {
    "SecretKey": "your-super-secret-key-here-minimum-32-characters",
    "Issuer": "WeatherTrackerAPI",
    "Audience": "WeatherTrackerAPI-Users",
    "ExpirationInMinutes": 60
  },
  "NasaApiSettings": {
    "BaseUrl": "https://api.nasa.gov/planetary/apod",
    "ApiKey": "zR5OaEYqLP8dUuP3TjgJBz7PsVYKQaWOhhbqKgjd",
    "RateLimitPerHour": 1000
  }
}
```

### 4. Instalar Depend√™ncias
```bash
dotnet restore
```

### 5. Executar a Aplica√ß√£o
```bash
dotnet run
```

A API estar√° dispon√≠vel em:
- HTTP: `http://localhost:5170`
- HTTPS: `https://localhost:7230`
- Swagger UI: `https://localhost:7230/swagger`

## üìÅ Estrutura do Projeto

### Controllers
- **AuthController** - Autentica√ß√£o e registro
- **NasaController** - Opera√ß√µes com dados da NASA
- **HealthController** - Monitoramento da aplica√ß√£o

### Services  
- **AuthService** - L√≥gica de autentica√ß√£o
- **NasaService** - Integra√ß√£o com NASA API
- **UserService** - Gest√£o de usu√°rios

### Repositories
- **UserRepository** - Opera√ß√µes de usu√°rios
- **ApodRepository** - Dados astron√¥micos

### Models
- **User** - Entidade de usu√°rio
- **ApodEntity** - Dados astron√¥micos
- **ApodResponse** - Resposta da NASA API

### DTOs
- **LoginDto** - Dados de login
- **RegisterDto** - Dados de registro  
- **ApodDto** - Transfer√™ncia de dados astron√¥micos

## üîå API Endpoints

### Autentica√ß√£o
```http
POST /api/auth/register   # Registro de usu√°rio
POST /api/auth/login      # Login de usu√°rio
POST /api/auth/refresh    # Renovar token
```

### NASA Data
```http
GET    /api/nasa/apod              # Imagem astron√¥mica do dia
GET    /api/nasa/apod/{date}       # Imagem de data espec√≠fica
GET    /api/nasa/apod/range        # Per√≠odo de datas
POST   /api/nasa/sync              # Sincronizar dados
GET    /api/nasa/statistics        # Estat√≠sticas
```

### Usu√°rios (Protegido)
```http
GET    /api/users/profile          # Perfil do usu√°rio
PUT    /api/users/profile          # Atualizar perfil
GET    /api/users/history          # Hist√≥rico de consultas
```

### Sistema
```http
GET    /health                     # Status da aplica√ß√£o
GET    /swagger                    # Documenta√ß√£o da API
```

## üîê Autentica√ß√£o e Autoriza√ß√£o

### JWT Token Structure
```json
{
  "sub": "user-id",
  "email": "user@example.com",
  "role": "User",
  "exp": 1640995200,
  "iss": "WeatherTrackerAPI",
  "aud": "WeatherTrackerAPI-Users"
}
```

### Uso da Autentica√ß√£o
```http
Authorization: Bearer <jwt-token>
```

### Roles Dispon√≠veis
- **User** - Usu√°rio padr√£o
- **Admin** - Administrador

## üóÑÔ∏è Banco de Dados

### Schema Principal

#### Tabela Users
```sql
CREATE TABLE Users (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    Email NVARCHAR(255) UNIQUE NOT NULL,
    PasswordHash NVARCHAR(255) NOT NULL,
    FirstName NVARCHAR(100) NOT NULL,
    LastName NVARCHAR(100) NOT NULL,
    Role NVARCHAR(50) DEFAULT 'User',
    CreatedAt DATETIME2 DEFAULT GETUTCDATE(),
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE()
);
```

#### Tabela ApodData
```sql
CREATE TABLE ApodData (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    Date DATE UNIQUE NOT NULL,
    Title NVARCHAR(500) NOT NULL,
    Explanation NTEXT NOT NULL,
    Url NVARCHAR(1000) NOT NULL,
    HdUrl NVARCHAR(1000),
    MediaType NVARCHAR(50) NOT NULL,
    Copyright NVARCHAR(255),
    CreatedAt DATETIME2 DEFAULT GETUTCDATE(),
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE()
);
```

#### Tabela UserQueries
```sql
CREATE TABLE UserQueries (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    UserId UNIQUEIDENTIFIER FOREIGN KEY REFERENCES Users(Id),
    QueryType NVARCHAR(100) NOT NULL,
    QueryParameters NVARCHAR(1000),
    ExecutedAt DATETIME2 DEFAULT GETUTCDATE()
);
```

## ‚öôÔ∏è Configura√ß√µes

### appsettings.json
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "WeatherTrackerAPI": "Debug"
    }
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=WeatherTrackerDB;Trusted_Connection=true"
  },
  "JwtSettings": {
    "SecretKey": "production-secret-key",
    "Issuer": "WeatherTrackerAPI",
    "Audience": "WeatherTrackerAPI-Users",
    "ExpirationInMinutes": 60
  },
  "NasaApiSettings": {
    "BaseUrl": "https://api.nasa.gov/planetary/apod",
    "ApiKey": "zR5OaEYqLP8dUuP3TjgJBz7PsVYKQaWOhhbqKgjd",
    "RateLimitPerHour": 1000,
    "TimeoutInSeconds": 30
  }
}
```

## üß™ Testes

### Executar Testes
```bash
# Todos os testes
dotnet test

# Testes com coverage
dotnet test --collect:"XPlat Code Coverage"

# Testes espec√≠ficos
dotnet test --filter "Category=Unit"
dotnet test --filter "Category=Integration"
```

### Estrutura de Testes
```
Tests/
‚îú‚îÄ‚îÄ UnitTests/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îî‚îÄ‚îÄ Repositories/
‚îú‚îÄ‚îÄ IntegrationTests/
‚îÇ   ‚îú‚îÄ‚îÄ API/
‚îÇ   ‚îî‚îÄ‚îÄ Database/
‚îî‚îÄ‚îÄ TestHelpers/
    ‚îú‚îÄ‚îÄ Fixtures/
    ‚îî‚îÄ‚îÄ MockData/
```

## üöÄ Deploy

### Docker
```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:9.0 AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443

FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /src
COPY ["WeatherTrackerAPI.csproj", "."]
RUN dotnet restore "WeatherTrackerAPI.csproj"
COPY . .
WORKDIR "/src"
RUN dotnet build "WeatherTrackerAPI.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "WeatherTrackerAPI.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "WeatherTrackerAPI.dll"]
```

### Comandos Docker
```bash
# Build da imagem
docker build -t weathertracker-api .

# Executar container
docker run -p 8080:80 weathertracker-api
```

## ü§ù Contribui√ß√£o

### Fluxo de Desenvolvimento
1. Fork do projeto
2. Criar branch feature (`git checkout -b feature/nova-funcionalidade`)
3. Commit das mudan√ßas (`git commit -m 'feat: adicionar nova funcionalidade'`)
4. Push para branch (`git push origin feature/nova-funcionalidade`)
5. Abrir Pull Request

### Padr√µes de Commit
```
feat: nova funcionalidade
fix: corre√ß√£o de bug
docs: documenta√ß√£o
style: formata√ß√£o
refactor: refatora√ß√£o
test: testes
chore: manuten√ß√£o
```

## üìà Roadmap de Desenvolvimento

### Fase 1: Estrutura Base ‚úÖ
- [x] Configura√ß√£o inicial do projeto
- [x] Estrutura de pastas e arquitetura
- [x] Configura√ß√£o do Git e .gitignore

### Fase 2: Configura√ß√µes Fundamentais
- [ ] Classes de configura√ß√£o (JWT, NASA API)
- [ ] Setup do Entity Framework
- [ ] Configura√ß√£o do AutoMapper
- [ ] Middleware de autentica√ß√£o

### Fase 3: Modelos e DTOs
- [ ] Entidades do dom√≠nio
- [ ] DTOs para transfer√™ncia de dados
- [ ] Valida√ß√µes com FluentValidation
- [ ] Mapeamentos AutoMapper

### Fase 4: Acesso a Dados
- [ ] Contexto do Entity Framework
- [ ] Repositories base
- [ ] Migrations iniciais
- [ ] Seed de dados

### Fase 5: Servi√ßos de Neg√≥cio
- [ ] Servi√ßo de autentica√ß√£o
- [ ] Integra√ß√£o com NASA API
- [ ] Servi√ßos de usu√°rio
- [ ] Cache e otimiza√ß√µes

### Fase 6: Controladores da API
- [ ] Controller de autentica√ß√£o
- [ ] Controller da NASA API
- [ ] Valida√ß√µes e tratamento de erros
- [ ] Logging estruturado

### Fase 7: Documenta√ß√£o e Swagger
- [ ] Configura√ß√£o do Swagger
- [ ] Documenta√ß√£o dos endpoints
- [ ] Exemplos de requisi√ß√µes
- [ ] Schemas OpenAPI

### Fase 8: Testes
- [ ] Testes unit√°rios
- [ ] Testes de integra√ß√£o
- [ ] Mocks e fixtures
- [ ] Coverage reports

### Fase 9: Seguran√ßa e Performance
- [ ] Rate limiting
- [ ] CORS configuration
- [ ] Health checks
- [ ] Monitoring e m√©tricas

### Fase 10: Deploy e DevOps
- [ ] Dockeriza√ß√£o
- [ ] CI/CD pipeline
- [ ] Environment configs
- [ ] Documentation final

---

## üìö Recursos √öteis

- [NASA Open Data Portal](https://api.nasa.gov/)
- [ASP.NET Core Documentation](https://docs.microsoft.com/aspnet/core/)
- [Entity Framework Core](https://docs.microsoft.com/ef/core/)
- [JWT.IO](https://jwt.io/)
- [Swagger/OpenAPI](https://swagger.io/)

## üìÑ Licen√ßa

Este projeto √© licenciado sob a MIT License - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üë®‚Äçüíª Autor

**Italo Rocha**
- GitHub: [@ItaloRochaj](https://github.com/ItaloRochaj)
- LinkedIn: [Italo Rocha](https://linkedin.com/in/italorochaj)

---

‚≠ê **Se este projeto foi √∫til para voc√™, considere dar uma estrela!**